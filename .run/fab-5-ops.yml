name: fab-5-ops

labels:
  team: destinations
  owner: epd-destinations@segment.com
  github_repo: https://github.com/segmentio/fab-5-engine
  Autoscale::Target::CPU: 80
  Autoscale::Target::Mem: 70

container:
  image: fab-5-engine
  repository: 528451384384.dkr.ecr.us-west-2.amazonaws.com
  cmd: ['./scripts/run.sh']

expose:
  - name: http
    port: 3000
    proto: http
    health_check_path: /health
    health_check_status: 204

resources:
  cpu_shares: 512
  mem_mb: 512

count:
  production:
    min: 1
    max: 3
    autoscale_policy: cpu_mem_tracking
  stage:
    min: 1
    max: 3
    autoscale_policy: cpu_mem_tracking

autodeploy:
  production:
    branch: master
  stage:
    branch: staging

config:
  production:
    AWS_REGION: us-west-2
    NODE_ENV: production
    PORT: 3000
    UV_THREADPOOL_SIZE: 128
    DATADOG_AGENT_ADDR: '172.17.42.1:8125'
    SENTRY_DSN: https://e1f53320787f46a28883db55c7e73c71@o19879.ingest.sentry.io/5510102
    STATS_PREFIX: fab-5-ops

  stage: &stage_config
    AWS_REGION: us-west-2
    NODE_ENV: stage
    PORT: 3000
    UV_THREADPOOL_SIZE: 128
    DATADOG_AGENT_ADDR: '172.17.42.1:8125'
    SENTRY_DSN: https://e1f53320787f46a28883db55c7e73c71@o19879.ingest.sentry.io/5510102
    STATS_PREFIX: fab-5-ops

  dev:
    <<: *stage_config
